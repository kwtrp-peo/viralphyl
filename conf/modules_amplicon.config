/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
----------------------------------------------------------------------------------------
*/

//
// General configuration options
//

process {
    withName: 'GENERATE_SAMPLESHEET' {
        publishDir = [
                path: { "${params.outdir}/" },
                mode: params.publish_dir_mode,
                pattern: "*.{tsv,csv}"
            ]
    }


    //
    // Optional configuration options
    //

    if (!params.skip_assembly) {
        process {
            withName: 'ARTIC_GUPPYPLEX' {
                ext.args = [
                            params.normalize ? "--normalize ${params.normalize}" : '',
                            params.min_read_length ? "--min-length ${params.min_read_length}" : '',
                            params.max_read_length ? "--max-length ${params.max_read_length}" : ''
                        ].join(' ').trim()
                publishDir = [
                    path: { "${params.outdir}/guppyplex" },
                    enabled: false
                ]
            }
            
            withName: 'ARTIC_MINION' {
                ext.args =  ' params.normalize ? "--normalise ${params.normalize}" : "" ' 
                publishDir = [
                    path: { "${params.outdir}/minion" },
                    mode: params.publish_dir_mode,
                    pattern: "*.{sorted.bam,sorted.bam.bai,fail.vcf,merged.vcf,primers.vcf,gz,tbi,consensus.fasta}"
                ]
            }
        }
    }


//
// Optional configuration options
//

    if (!params.skip_qc) {
        process {
            withName: 'TOULLIG_QC' {
                publishDir = [
                    path: { "${params.outdir}/quality_check" },
                    mode: params.publish_dir_mode,
                    saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
                ]
            }
        }
    }

    
}